# CNN

CNN은 Convolutional Neural Network의 약자로 일반 DNN에서 이미지나 영상과 같은 데이터를 처리할 때 발생하는 문제점들을 보완한 방법입니다.

## CNN의 처리방법

### 1. 픽셀화

아래와 같은 손글씨 이미지가 있다고 합시다.

<이미지 1>

이와 같은 이미지에 대해서 픽셀로 나눠볼 수 있습니다.

<이미지 2>

위의 빨간 네모 한칸을 1픽셀이라 생각하고, 이 픽셀에는 (R(0~255), G(0~255), B(0~255)) 사이의 컬러가 들어가 있습니다.

즉 한픽셀당 3차원의 값이 들어가게 되는 것입니다.

그러나 지금은 개념만 잡는 부분이기 때문에 이해하기 쉽도록 0과 1로만 구분이 된다고 생각해봅시다.

그렇게 된다면 아래와 같이 숫자 "8"을 나타낼 수 있습니다.
(흰 픽셀은 0, 나머지 픽셀은 1)

<이미지 3>

**CNN에서는 이 이미지의 한 픽셀과, 주변 픽셀들의 연관관계를 유지시키며 학습시키는 것을 목표로 합니다.**

### 2. Convolution
Convolution은 하나의 이미지로부터 픽셀의 연관성을 살린 여러 개의 이미지를 생성하는 것입니다.

n*n 크기의 이미지를 뽑아내서 같은 크기의 랜덤값을 가지고 있는 데이터와 픽셀을 곱해서 더해줍니다.

이때 랜덤값을 가지고 있는 n*n 데이터를 필터라고 부릅니다.

필터를 한픽셀씩 옮기며 새로운 이미지를 완성하는 방식입니다.

이렇게 새 이미지를 생성하는 방법이 Convolution입니다.

수학적으로 다시 정리해보겠습니다.


필터 갯수 = X
필터 크기 = Y

이미지 크기 = Z * Z

-> 이때 만들어지는 새 이미지 크기와 갯수 : 크기 = (Z-Y+1) * (Z-Y+1), 갯수 = Y개

이번에는 아까의 숫자 8 그림에 대해 Convolution 해봅시다.

아래 같은 3 * 3 필터 3개를 준비했다고 가정합시다.

<이미지 4>

그리고 아까 픽셀화를 한 숫자 8 이미지의 크기는 28 * 28입니다.

<이미지 5>

필터 1번이 한칸씩 움직이면서 새로운 이미지를 만들게 됩니다.

<이미지 6>

~

<이미지 9>

이때 만들어지는 이미지는 (28-3+1) * (28-3+1), 즉 26 * 26 크기의 새로운 이미지를 만들게 됩니다.

이러한 과정을 필터갯수인 3번 반복하면, 26 * 26의 이미지 3개가 완성됩니다.

필터의 갯수가 수백개이면, 이미지 하나를 서로다른 수백개의 이미지로 표현할 수 있습니다. 즉 이미지 100개에 필터 100개를 사용한다면 10000개의 Convolution된 이미지들을 얻을 수 있는 것입니다.

이것이 CNN의 핵심이자 "C"부분인 Convolution 과정이였습니다.

> 28 * 28 크기의 이미지를 Convolution 하면 이미지 크기가 줄어들게 되는데, 줄어든만큼 손실되었다고도 볼 수 있습니다. 이미지 크기를 padding이라는 것을 이용하여 유지하는 방법도 있습니다.

* padding : 원본 이미지의 상하좌우 테두리에 0 값을 갖는 데이터를 추가하여, Convolution을 적용한 크기가 원래의 크기와 동일하게 유지하도록 하는 방법.

### 3. Pooling
Pooling은 CNN의 문제점 중 하나를 보완하는 방법입니다.

Convolution 과정을 통해서 많은 수의 이미지를 생성을 할 수 있었습니다.

큰 크기의 많은 이미지를 처리하려면 상당한 연산 시간이 걸리게 됩니다.

Convolution으로 이미지 수를 늘렸다면, Pooling으로는 이미지의 크기를 줄이게 됩니다.

n * n 크기의 Pooling 필터가 주어지면, n * n 크기중 가장 특성값 하나만 추출하게 되는 것입니다.

가장 많이 쓰게되는 pooling 방법은 Max Pooling입니다.
풀링된 픽셀내의 최댓값을 뽑아 내는 방법입니다.

<이미지 10>

아래처럼 숫자 8 이미지에서 2 * 2의 풀링 픽셀로 나누게된다면 파란 네모 한칸이 될 것입니다.

<이미지 11>

여기서 Max Pooling을 사용한다면 파란픽셀안의 4 픽셀값중 가장 큰 픽셀하나만 뽑혀서 재구성됩니다. 28 * 28크기가 14(28/2) * 14(28/2) 크기로 줄게 되는 것입니다.

Convolution과 Pooling을 반복하면 이미지의 갯수는 많아지면서 크기는 점점 줄어들게 됩니다. 바로 아래의 그림처럼 말입니다.

<이미지 12>